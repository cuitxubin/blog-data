# 深入分析集群安全机制

k8s 的集群的安全控制机制包括：API Server 的认证授权、准入控制机制及保护敏感信息的 Secret 机制等。

集群安全性的目标：

1. 保证容器与其所在宿主机的隔离。
2. 限制容器给基础设施或其他容器带来的干扰。
3. 最小权限原则 --- 合理限制所有组件的权限，确保组件只执行它被授权的行为，通过限制单个组件的能力来限制他的权限范围
4. 明确组件间边界的划分。
5. 划分普通用户和管理员的角色。
6. 在必要时允许将管理员权限赋给普通用户。
7. 允许拥有 Secret 数据（Keys，Certs，Passwords）的应用在集群中运行。

下面分别从 Authentication、Authorization、Admission Control、Secret 和 Service Accounnt 等方面学习。

## API Server 认证管理

API Server的安全关键点在于认证和授权。这一节先学习认证。

K8s 集群提供了三种级别的客户端认证方式：

- 最严格的 HTTPS 证书认证：基于 CA 根证书签名的双向数字证书认证方式。
- HTTP Token 认证：通过一个 Token 来识别合法用户。
- HTTP Base 认证：通过用户名 + 密码的方式认证。

## API Server 授权管理

API Server 目前支持一下几种授权策略（通过 API Server 的启动参数 --authorization-mode 设置）

- **AlwaysDeny**: 表示拒绝所有请求，一般用于测试
- **AlwaysAllow** 允许接受所有请求，如果集群不需要授权流程，则可以采用该策略，这也是 Kubernetes 的默认配置。
- **ABAC**（Attribute-Based Access Control）基于属性的访问控制，表示使用用户配置的授权规则对用户请求进行匹配和控制。
- **Webhook** 通过调用外部 REST 服务对用户进行授权。
- **RBAC** Role-Based Access Control，基于角色的访问控制。
- **Node** 一种专用模式，用于对 kubelet 发出的请求进行访问控制

